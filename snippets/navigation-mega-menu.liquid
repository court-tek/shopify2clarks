{% comment %}
  Renders a megamenu for the header.

  Usage:
  {% render 'navigation-mega-menu' %}
{% endcomment %}
<div class="header4__navigation-wrapper">
  <nav class="header4__navigation">
    <ul class="header4__list">
      {%- for link in section.settings.menu.links -%}
        <li class="header4__list-item has-submenu">
          {%- assign images_present = false -%}
          {%- for block in section.blocks -%}
            {%- if block.settings.link_name == link.title -%}
              {%- assign images_present = true -%}
            {%- endif -%}
          {%- endfor -%}
          {%- if link.links != blank or images_present -%}
            <a href="#" class="header4__index {{ forloop.index }}">
              <span class="header4__link-title header4__link-title--sale">{{- link.title | escape -}}</span>
            </a>
            <div class="header4__submenu-wrapper">
              <div class="header4__submenu-delete">
                <div class="header4__submenu-item header4__submenu-grid header4__submenu-grid--{{ link.title }}">
                  {% comment %} normal links {% endcomment %}
                  {%- for childlink in link.links -%}
                    <ul class="header4__links-list">
                      <li>
                        <ul class="header4__spacer">
                          <li class="header4__header-link-underline">
                            <a class="header4__submenu-category header4__submenu-category--underline" href="#">
                              {{- childlink.title | escape -}}
                            </a>
                          </li>
                        </ul>
                        {%- if childlink.links != blank -%}
                          <ul>
                            {%- for grandchildlink in childlink.links -%}
                              <li class="header4__sub-list-item">
                                <a
                                  class="header4__sub-link header4__sub-link--underline"
                                  href="{{ grandchildlink.url }}"
                                >
                                  {{- grandchildlink.title | escape -}}
                                </a>
                              </li>
                            {%- endfor -%}
                          </ul>
                        {%- endif -%}
                      </li>
                    </ul>
                  {%- endfor -%}

                  {% comment %} image links {% endcomment %}
                  {%- for block in section.blocks -%}
                    {%- if link.title == block.settings.link_name -%}
                      <div class="header4__links-list">
                          {{ block.settings.link_image | image_url: width: 190, height: 285| image_tag }}
                          <div class="header4__menu-info">
                            <span class="header4__copy-heading">{{ block.settings.link_header }}</span>
                            <a class="header4__link-to" href="{{ block.settings.link_url}}">{{ block.settings.link_title }}</a>
                          </div>
                      </div>
                    {%- endif -%}
                  {%- endfor -%}
                </div>
              </div>
            </div>
          {%- endif -%}
        </li>
      {%- endfor -%}
    </ul>
  </nav>
</div>
